# Daily Processing Report
# Generates a daily report of processed issues
name: Daily Processing Report

on:
  schedule:
    - cron: '0 9 * * *'  # ÊØéÊó•9ÊôÇ (UTC)
  workflow_dispatch:

jobs:
  generate-report:
    runs-on: ubuntu-latest
    steps:
      - name: Generate Report
        uses: actions/github-script@v7
        with:
          script: |
            const oneDayAgo = new Date(Date.now() - 24*60*60*1000).toISOString();
            
            // Âá¶ÁêÜÊ∏à„ÅøIssueÂèñÂæó
            const processed = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: 'claude-code-completed',
              since: oneDayAgo,
              state: 'all'
            });
            
            // Â§±ÊïóIssueÂèñÂæó
            const failed = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: 'claude-code-failed',
              since: oneDayAgo,
              state: 'all'
            });
            
            // ÂæÖÊ©ü‰∏≠IssueÂèñÂæó
            const waiting = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: 'claude-code-waiting',
              state: 'open'
            });
            
            // Âá¶ÁêÜ‰∏≠IssueÂèñÂæó
            const processing = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: 'claude-code-processing',
              state: 'open'
            });
            
            // „É¨„Éù„Éº„Éà‰ΩúÊàê
            const totalProcessed = processed.data.length + failed.data.length;
            const successRate = totalProcessed > 0 
              ? (processed.data.length / totalProcessed * 100).toFixed(1)
              : 0;
              
            const report = `# üìä Daily Processing Report
            
**Date**: ${new Date().toLocaleDateString()}
**Time**: ${new Date().toLocaleTimeString()} UTC
            
## Summary
- ‚úÖ Processed: ${processed.data.length}
- ‚ùå Failed: ${failed.data.length}
- ‚è≥ Waiting: ${waiting.data.length}
- üîÑ Processing: ${processing.data.length}
- üéØ Success Rate: ${successRate}%
            
## Details

### Successfully Processed
${processed.data.length > 0 
  ? processed.data.map(i => `- #${i.number}: ${i.title}`).join('\n')
  : '- No issues processed successfully'}
            
### Failed Processing
${failed.data.length > 0
  ? failed.data.map(i => `- #${i.number}: ${i.title}`).join('\n')
  : '- No failed issues'}
  
### Currently Waiting
${waiting.data.length > 0
  ? waiting.data.map(i => `- #${i.number}: ${i.title}`).join('\n')
  : '- No issues waiting'}
  
### Currently Processing
${processing.data.length > 0
  ? processing.data.map(i => `- #${i.number}: ${i.title}`).join('\n')
  : '- No issues currently processing'}

---
*Report generated by GitHub Actions Label Processor*
`;
            
            // Issue‰ΩúÊàê
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `Daily Report - ${new Date().toLocaleDateString()}`,
              body: report,
              labels: ['report', 'automated']
            });